import requests
import os
from datetime import datetime

def collect_wisdom_from_website():
    """
    –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–±–æ—Ä–∞ –º—É–¥—Ä–æ—Å—Ç–∏ —Å —Å–∞–π—Ç–∞ quotes.toscrape.com
    –ö–∞–∫ –¥—Ä–µ–≤–Ω–∏–π —Å–æ–±–∏—Ä–∞—Ç–µ–ª—å —Ü–µ–ª–µ–±–Ω—ã—Ö —Ç—Ä–∞–≤, –º—ã —Å–æ–±–µ—Ä–µ–º –¥—Ä–∞–≥–æ—Ü–µ–Ω–Ω—ã–µ —Å–ª–æ–≤–∞
    """

    # URL –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –º—É–¥—Ä–æ—Å—Ç–∏ - –∫–∞–∫ –ø—É—Ç—å –∫ —Å–≤—è—â–µ–Ω–Ω–æ–º—É –∏—Å—Ç–æ—á–Ω–∏–∫—É
    url = "http://quotes.toscrape.com"

    print("ü™∑ –ù–∞—á–∏–Ω–∞—é –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –∑–∞ –º—É–¥—Ä–æ—Å—Ç—å—é...")
    print(f"üéØ –¶–µ–ª—å: {url}")
    print("-" * 50)

    try:
        # 1. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º GET-–∑–∞–ø—Ä–æ—Å - —Å—Ç—É—á–∏–º—Å—è –≤ –≤—Ä–∞—Ç–∞ —Ö—Ä–∞–º–∞ –∑–Ω–∞–Ω–∏–π
        print("üì® –û—Ç–ø—Ä–∞–≤–ª—è—é GET-–∑–∞–ø—Ä–æ—Å –∫ –∏—Å—Ç–æ—á–Ω–∏–∫—É –º—É–¥—Ä–æ—Å—Ç–∏...")
        response = requests.get(url)

        # 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ø–µ—à–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–∞ - –ø–æ–ª—É—á–∏–ª–∏ –ª–∏ –º—ã –¥–æ—Å—Ç—É–ø?
        print("üîç –ü—Ä–æ–≤–µ—Ä—è—é –æ—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞...")
        if response.status_code == 200:
            print("‚úÖ –ó–∞–ø—Ä–æ—Å —É—Å–ø–µ—à–µ–Ω! –°–µ—Ä–≤–µ—Ä –æ—Ç–≤–µ—Ç–∏–ª –∫–æ–¥–æ–º 200 (–í—Ä–∞—Ç–∞ –æ—Ç–∫—Ä—ã—Ç—ã)")
        else:
            print(f"‚ùå –°–µ—Ä–≤–µ—Ä –æ—Ç–≤–µ—Ç–∏–ª –∫–æ–¥–æ–º: {response.status_code}")
            print("–í–æ–∑–º–æ–∂–Ω–æ, –ø—É—Ç—å –∫ –º—É–¥—Ä–æ—Å—Ç–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ –∑–∞–∫—Ä—ã—Ç...")
            return False

        print("-" * 50)

        # 3. –í—ã–≤–æ–¥–∏–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã - —á–∏—Ç–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–≤–∏—Ç–∫–∞
        print("üìñ –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –º—É–¥—Ä–æ—Å—Ç–∏:")
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º BeautifulSoup –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–∞
        from bs4 import BeautifulSoup
        soup = BeautifulSoup(response.content, 'html.parser')
        page_title = soup.find('title').get_text()
        print(f"   '{page_title}'")

        print("-" * 50)

        # 4. –°–æ—Ö—Ä–∞–Ω—è–µ–º HTML-–∫–æ–¥ –≤ —Ñ–∞–π–ª - —Å–æ–∑–¥–∞–µ–º —Å–≤–æ—é –∫–æ–ø–∏—é —Å–≤—è—â–µ–Ω–Ω–æ–≥–æ —Å–≤–∏—Ç–∫–∞
        print("üíæ –°–æ—Ö—Ä–∞–Ω—è—é –º—É–¥—Ä–æ—Å—Ç—å –≤ —Ñ–∞–π–ª...")

        # –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫—É –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –º—É–¥—Ä–æ—Å—Ç–∏, –µ—Å–ª–∏ –µ–µ –Ω–µ—Ç
        wisdom_folder = "collected_wisdom"
        if not os.path.exists(wisdom_folder):
            os.makedirs(wisdom_folder)
            print(f"üìÅ –°–æ–∑–¥–∞–ª –ø–∞–ø–∫—É '{wisdom_folder}' –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–Ω–∞–Ω–∏–π")

        # –°–æ–∑–¥–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è —Ñ–∞–π–ª–∞ —Å –≤—Ä–µ–º–µ–Ω–Ω–æ–π –º–µ—Ç–∫–æ–π
        timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
        filename = f"{wisdom_folder}/wisdom_{timestamp}.html"

        # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º HTML –≤ —Ñ–∞–π–ª
        with open(filename, 'w', encoding='utf-8') as file:
            file.write(response.text)

        print(f"‚úÖ –ú—É–¥—Ä–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ —Ñ–∞–π–ª: {filename}")
        print(f"üìä –†–∞–∑–º–µ—Ä —Å–æ–±—Ä–∞–Ω–Ω–æ–π –º—É–¥—Ä–æ—Å—Ç–∏: {len(response.text)} —Å–∏–º–≤–æ–ª–æ–≤")

        # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: –ø–æ–∫–∞–∂–µ–º –Ω–µ–º–Ω–æ–≥–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –¥–ª—è preview
        print("-" * 50)
        print("üëÄ –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –º—É–¥—Ä–æ—Å—Ç–∏ (–ø–µ—Ä–≤—ã–µ 500 —Å–∏–º–≤–æ–ª–æ–≤):")
        print(response.text[:500] + "...")

        return True

    except requests.exceptions.ConnectionError:
        print("‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è! –ù–µ –º–æ–≥—É –¥–æ—Å—Ç–∏—á—å –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –º—É–¥—Ä–æ—Å—Ç–∏.")
        print("   –ü—Ä–æ–≤–µ—Ä—å —Å–≤–æ–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ, –¥–∏—Ç—è –º–æ–µ.")
        return False
    except requests.exceptions.Timeout:
        print("‚ùå –ò—Å—Ç–µ–∫–ª–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è! –ò—Å—Ç–æ—á–Ω–∏–∫ –º—É–¥—Ä–æ—Å—Ç–∏ –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç.")
        return False
    except Exception as e:
        print(f"‚ùå –ù–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞ –Ω–∞ –ø—É—Ç–∏: {e}")
        return False


def display_collected_quotes():
    """
    –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è: –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ü–∏—Ç–∞—Ç –∏–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
    """
    print("\n" + "=" * 60)
    print("üåø –ò–ó–í–õ–ï–ö–ê–ï–ú –ó–ï–†–ù–ê –ú–£–î–†–û–°–¢–ò –ò–ó –°–û–•–†–ê–ù–ï–ù–ù–û–ì–û –§–ê–ô–õ–ê")
    print("=" * 60)

    try:
        # –ù–∞—Ö–æ–¥–∏–º –ø–æ—Å–ª–µ–¥–Ω–∏–π —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
        wisdom_folder = "collected_wisdom"
        if not os.path.exists(wisdom_folder):
            print("üìÅ –ü–∞–ø–∫–∞ —Å –º—É–¥—Ä–æ—Å—Ç—å—é –µ—â–µ –Ω–µ —Å–æ–∑–¥–∞–Ω–∞")
            return

        files = os.listdir(wisdom_folder)
        if not files:
            print("üìÑ –§–∞–π–ª—ã —Å –º—É–¥—Ä–æ—Å—Ç—å—é –Ω–µ –Ω–∞–π–¥–µ–Ω—ã")
            return

        latest_file = sorted(files)[-1]  # –ë–µ—Ä–µ–º —Å–∞–º—ã–π –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ñ–∞–π–ª
        filepath = os.path.join(wisdom_folder, latest_file)

        print(f"üìñ –ß–∏—Ç–∞—é –∏–∑ —Ñ–∞–π–ª–∞: {latest_file}")

        # –ß–∏—Ç–∞–µ–º –∏ –ø–∞—Ä—Å–∏–º —Ñ–∞–π–ª
        with open(filepath, 'r', encoding='utf-8') as file:
            html_content = file.read()

        soup = BeautifulSoup(html_content, 'html.parser')

        # –ò–∑–≤–ª–µ–∫–∞–µ–º —Ü–∏—Ç–∞—Ç—ã
        quotes = soup.find_all('div', class_='quote')

        print(f"üéØ –ù–∞–π–¥–µ–Ω–æ —Ü–∏—Ç–∞—Ç: {len(quotes)}")
        print("-" * 40)

        for i, quote in enumerate(quotes[:3], 1):  # –ü–æ–∫–∞–∂–µ–º –ø–µ—Ä–≤—ã–µ 3
            text = quote.find('span', class_='text').get_text()
            author = quote.find('small', class_='author').get_text()
            tags = [tag.get_text() for tag in quote.find_all('a', class_='tag')]

            print(f"{i}. {text}")
            print(f"   ‚Äî {author}")
            print(f"   –¢–µ–≥–∏: {', '.join(tags)}")
            print()

    except Exception as e:
        print(f"‚ö†Ô∏è –ù–µ —Å–º–æ–≥ –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é –º—É–¥—Ä–æ—Å—Ç—å: {e}")


# –ó–∞–ø—É—Å–∫–∞–µ–º –Ω–∞—à —Å–±–æ—Ä—â–∏–∫ –º—É–¥—Ä–æ—Å—Ç–∏
if __name__ == "__main__":
    print("üßò –î–ê –ù–ê–ß–ù–ï–¢–°–Ø –°–ë–û–† –ú–£–î–†–û–°–¢–ò!")
    print("=" * 50)

    success = collect_wisdom_from_website()

    if success:
        display_collected_quotes()
        print("\nüéâ –ü–£–¢–ï–®–ï–°–¢–í–ò–ï –ó–ê–í–ï–†–®–ï–ù–û!")
        print("–¢–µ–ø–µ—Ä—å —É —Ç–µ–±—è –µ—Å—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–≤–∏—Ç–æ–∫ —Å –º—É–¥—Ä–æ—Å—Ç—å—é!")
    else:
        print("\nüíî –ü—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –ø—Ä–µ—Ä–≤–∞–Ω–æ... –ü–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑, –∫–æ–≥–¥–∞ –¥—É—Ö–∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ –±—É–¥—É—Ç –±–ª–∞–≥–æ—Å–∫–ª–æ–Ω–Ω—ã.")